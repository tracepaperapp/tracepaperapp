<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XML Parsing</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/4.2.5/fxparser.min.js"></script>
    <script src="/spikes/js/xml-builder.js"></script>

    <script>
        const options = {
                ignoreAttributes : false,
                format: true,
                attributeNamePrefix : "att_"
          };

        function convertXML(xml){
            const parser = new XMLParser(options);
            return parser.parse(xml);
        }

        function convertJSON(json){
          // De gebruikte library zet om onbekende reden (wrs omdat het onderwater een of andere DOM lib gebruikt)
          // attributen met de value "true" om in naked attributen. Helaas vind onze generator dat niet zo leuk.
          // Vandaar de onderstaande hack.
          let placeholder = "placeholder-6a3eacfc-85ff-4414-938d-511785c46536";
          json = json.replaceAll('"true"','"' + placeholder + '"');
          json = JSON.parse(json);
          const builder = new XMLBuilder(options);
          let xml = builder.build(json);
          xml = xml.replaceAll(placeholder,"true");
          return xml;
        }
    </script>
</head>
<body x-data="{xml: '', json: ''}">

    <br>
    <br>
    <h4>XML</h4>
    <textarea x-model="xml" rows="15" cols="200"></textarea>

    <br>
    <br>
    <h4>JSON</h4>
    <textarea x-model="json" rows="15" cols="200"></textarea>
    <br><br>
    <button @click="fetch('/spikes/example.xml').then( r => r.text()).then(t => xml = t)">Load example XML</button>
    <button @click="json = JSON.stringify(convertXML(xml),null,2)">XML -> JSON</button>
    <button @click="xml = ''">Clear XML</button>
    <button @click="xml = convertJSON(json)">JSON -> XML</button>
</body>
</html>