<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Tracepaper Tool" />
    <title>Workspace</title>
    <link rel="icon" type="image/x-icon" href="/assets/draftsman-logo.png" />
    <script src="/js/configuration.js"></script>
    <script src="/js/draftsman.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css"
          integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <link rel="stylesheet" href="/css/customs.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="/js/custom-form.js"></script>
    <script src="/js/globals.js"></script>
</head>
<body class="d-flex flex-column h-100" x-data x-import="custom-navbar;
                                                        commands/Project/create;
                                                        utils/simple-cards;
                                                        utils/form-modal">

<main class="flex-shrink-0">

    <!-- Configure navbar -->
    <ui-navbar :path="[
        ['Home','/'],
        ['Workspace','/workspace?drn=' + Draftsman.fetch_query_parameter('drn')]
    ]" disable-domain-browser></ui-navbar>

    <!-- Import prepared query -->
    <draftsman-query alias="data" x-include="/prepared-statements/workspace.txt" authenticated>
    </draftsman-query>

    <!-- Make sure the data is refreshed if a certain view is updated -->
    <draftsman-notification message="updated" type="Project"
                            @notification="
                                if ($event.detail.identifier.startsWith(Draftsman.fetch_query_parameter('drn'))) {
                                    Draftsman.force_reload_data();
                                }">
    </draftsman-notification>

    <!-- The body of this page -->
    <div class="container data-element" x-data="{data: $store.data.get}"
         @refresh="data = $store.data.get">
        <h1><span x-text="data.name"></span> projects</h1>
        <hr>
        <ui-simple-cards alias="data"
                         path="get.projects"
                         command="initializeProject"
                         child-slug="project"></ui-simple-cards>
    </div>

    <!-- Import a command -->
    <ui-create-project command="initializeProject"></ui-create-project>

    <!-- Bind a form modal to the command -->
    <ui-form-modal
            alias="initializeProject"
            title="Initialize a new project"
            sort-keys="['name','documentation']"
            :pre-fill="{'workspaceDrn' : Draftsman.fetch_query_parameter('drn')}"
            hide="['workspaceDrn']"></ui-form-modal>

    <!-- Reset form and close modal on specific trace -->
    <draftsman-trace command="initializeProject"
                     component="TestSuiteConfig.Create"
                     status="success"
                     @trace="
                        Draftsman.empty_track_and_trace_log();
                        $dispatch('setdata',{command: 'initializeProject',data:{} });
                        $('#modal_initializeProject').modal('hide');">
    </draftsman-trace>

    <!-- Clear cache & Navigate on view update, this view update is an effect of the command -->
    <draftsman-notification message="updated" type="Project"
                            @notification="
        if ($event.detail.identifier === $store.mutation.last_command.workspaceDrn + ':' + $store.mutation.last_command.name){
            Draftsman.clear_cache();
            location = '/project?drn=' + $event.detail.identifier;
        }">
    </draftsman-notification>

</main>
</body>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
</html>
