<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Tracepaper Tool" />
    <title>Commands</title>
    <link rel="icon" type="image/x-icon" href="/assets/draftsman-logo.png" />
    <script src="/js/configuration.js"></script>
    <script src="/js/draftsman.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css"
          integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <link rel="stylesheet" href="/css/customs.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="/js/custom-form.js"></script>
    <script src="/js/globals.js"></script>
</head>
<body class="d-flex flex-column h-100" x-data x-import="custom-navbar;
                                                        utils/simple-cards;
                                                        custom-forms/command-form;
                                                        commands/Command/create;">

<main class="flex-shrink-0" x-data="{search: ''}">

    <!-- Configure navbar -->
    <ui-navbar :path="[
        ['Home','/'],
        ['Workspace','/workspace?drn=' + get_drn(2)],
        [get_project_name(),'/project?drn=' +get_drn(3)],
        ['Commands','/commands?drn=' +get_drn(3)]
    ]" disable-domain-browser></ui-navbar>

    <!-- Import prepared query -->
    <draftsman-query alias="commands" x-include="/prepared-statements/command/commands.txt" authenticated>
    </draftsman-query>

    <!-- The body of this page -->
    <div class="container data-element" x-data="{commands: $store.commands.get}"
         @refresh="commands = $store.commands.get">
        <h1>Commands for: <span x-text="get_project_name()"></span></h1>
        <hr>
        <ui-simple-cards alias="commands"
                         path="filter.resultset"
                         command="create-command"
                         child-slug="command"></ui-simple-cards>
    </div>

    <!-- Import a command -->
    <ui-create-command command="create-command"></ui-create-command>

    <!-- Bind a form modal to the command -->
    <ui-command-form
            alias="create-command"
            title="Initialize a new command"></ui-command-form>

    <!-- Reset form and close modal on specific trace -->
    <draftsman-trace command="create-command"
                     component="Command.Create"
                     status="success"
                     @trace="
                        Draftsman.empty_track_and_trace_log();
                        $dispatch('setdata',{command: 'create-command',data:{projectDrn: get_drn()} });
                        $('#modal_create-command').modal('hide');">
    </draftsman-trace>

    <!-- Make sure the data is refreshed if a certain view is updated -->
    <draftsman-notification message="updated" type="Command"
                            @notification="
                                if ($event.detail.identifier === $store.mutation.last_command.projectDrn + ':command:' + $store.mutation.last_command.name){
                                    Draftsman.clear_cache();
                                    location = '/command?drn=' + $event.detail.identifier;
                                } else if ($event.detail.identifier.startsWith(Draftsman.fetch_query_parameter('drn'))) {
                                    Draftsman.force_reload_data();
                                }">
    </draftsman-notification>

</main>
</body>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
</html>
